<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-5 items-stretch">
    {% for data in services_datas %}
        <!-- Premium Compact Card -->
        <div class="group relative bg-white rounded-2xl p-5 shadow-lg hover:shadow-2xl transition-all duration-500 border border-gray-100 hover:border-transparent overflow-hidden">
            
            <!-- Animated Gradient Border -->
            <div class="absolute inset-0 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 rounded-2xl opacity-0 group-hover:opacity-100 transition-all duration-700 -z-10"></div>
            <div class="absolute inset-[1.5px] bg-white rounded-2xl -z-10"></div>
            
            <!-- Glow Effect -->
            <div class="absolute inset-0 bg-gradient-to-br from-blue-100/20 via-purple-100/10 to-pink-100/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"></div>

            <!-- Category Badge -->
            <div class="absolute -top-2 -right-2 z-20">
                {% if data.is_for_libraries %}
                    <span class="px-3 py-1 bg-gradient-to-r from-emerald-500 to-green-600 text-white text-xs font-bold rounded-full shadow-lg flex items-center gap-1">
                        <i class="fas fa-cube text-xs"></i> LIBRARY
                    </span>
                {% elif data.is_for_blog_posts %}
                    <span class="px-3 py-1 bg-gradient-to-r from-purple-500 to-pink-600 text-white text-xs font-bold rounded-full shadow-lg flex items-center gap-1">
                        <i class="fas fa-feather text-xs"></i> BLOG
                    </span>
                {% endif %}
            </div>

            <!-- Card Content -->
            <div class="relative z-10 flex flex-col h-full">
                <!-- Header Section -->
                <div class="flex-1">
                    {% if data.is_for_blog_posts %}
                    <a href="{% url 'blogs:post_detail' id=data.id %}" class="block group/link">
                        {% if data.image %}
                            <div class="relative overflow-hidden rounded-xl mb-3">
                                <img src="{{ data.image.url }}" alt="{{ data.title|default:'Service Image' }}" 
                                     class="w-full h-32 object-cover rounded-xl transform group-hover/link:scale-105 transition-transform duration-500">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent opacity-0 group-hover/link:opacity-100 transition-opacity duration-300 rounded-xl"></div>
                            </div>
                        {% endif %}
                        <h2 class="text-lg font-bold text-gray-800 group-hover/link:text-transparent group-hover/link:bg-gradient-to-r group-hover/link:from-blue-600 group-hover/link:to-purple-600 group-hover/link:bg-clip-text transition-all duration-300 leading-tight">
                            {{ data.title|default:"Untitled Service" }}
                        </h2>
                    </a>
                    {% elif data.is_for_libraries %}
                    <h2 class="text-lg font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent leading-tight">
                        {{ data.title|default:"Untitled Service" }}
                    </h2>
                    {% endif %}

                    <!-- Content Section -->
                    {% if data.is_for_libraries %}
                    <div class="library-card-content mt-3">
                        <p class="text-gray-600 text-sm leading-relaxed">
                            {% if data.description|length > 100 %}
                                <span class="short-text">{{ data.description|slice:":100" }}</span>
                                <span class="full-text hidden">{{ data.description }}</span>
                                <button class="text-blue-500 hover:text-blue-700 text-xs font-medium toggle-text transition-colors duration-300">..More</button>
                            {% else %}
                                {{ data.description }}
                            {% endif %}
                        </p>

                        <div class="mt-3">
                            <div class="library-container w-full p-3 border border-gray-200 rounded-xl bg-gray-50 group-hover:bg-blue-50 transition-colors duration-300 overflow-hidden">
                                <pre class="library-content m-0 font-mono text-xs text-gray-700 whitespace-pre-wrap break-words">{{ data.library_link|default:'No link available' }}</pre>
                            </div>

                            {% if data.library_link %}
                                <div class="flex justify-between mt-3 space-x-2">
                                    <a href="{% url 'resources:library_detail' id=data.id %}">
                                        <button class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-sm font-semibold shadow-md hover:shadow-lg">
                                            <i class="fas fa-play-circle mr-1"></i> Use Guide
                                        </button>
                                    </a>

                                    <button
                                        data-post-id="{{ data.id }}"
                                        data-link="{{ data.library_link }}"
                                        class="px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-500/50 text-sm font-semibold shadow-md hover:shadow-lg copy-btn">
                                        <i class="fas fa-copy mr-1"></i> Copy
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    {% elif data.is_for_blog_posts %}
                    <div class="blog-card mt-3" data-id="{{ data.id }}">
                        <div class="blog-card-content">
                            <p class="text-gray-600 text-sm leading-relaxed preview-text">
                                <a href="{% url 'blogs:post_detail' id=data.id %}" class="hover:text-gray-800 transition-colors duration-300">
                                    {{ data.post_content|truncatewords:25 }}
                                </a>
                            </p>
                            
                            <div class="flex items-center justify-between mt-4 pt-3 border-t border-gray-100">
                                {% if data.full_post_content %}
                                <a href="{% url 'blogs:post_detail' id=data.id %}">
                                    <span class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-300 transform hover:scale-105 shadow-md hover:shadow-lg text-sm font-semibold">
                                        <i class="fas fa-arrow-right mr-1"></i> Read More
                                    </span>
                                </a>
                                {% endif %}
                                
                                <div class="flex space-x-2 ml-auto">
                                    <!-- Like button -->
                                    <button 
                                        class="flex items-center space-x-1 px-3 py-1.5 rounded-lg bg-gradient-to-r from-red-50 to-pink-50 border border-red-100 text-red-500 hover:from-red-100 hover:to-pink-100 hover:text-red-600 hover:border-red-200 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md group/like text-sm"
                                        title="Like"
                                        data-like-button
                                        data-post-id="{{ data.id }}"
                                    >
                                        <i class="fas fa-heart text-xs group-hover/like:scale-110 transition-transform duration-300"></i>
                                        <span class="likes-count font-semibold">{{ data.likes }}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Footer Meta -->
                <div class="mt-4 pt-3 border-t border-gray-100">
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span class="flex items-center gap-1 read-time-container">
                            <i class="fas fa-calendar-alt"></i>
                            <span class="read-time">{{ data.created_at|date:"F j, Y" }}</span>
                        </span>
                        <span class="flex items-center gap-1 view-count-container">
                            <i class="fas fa-eye"></i>
                            <span class="view-count">{{ data.views }} views</span>
                        </span>
                    </div>
                </div>

            </div>

            <!-- Hover Effect Dots -->
            <div class="absolute -bottom-2 -left-2 w-4 h-4 bg-blue-400 rounded-full opacity-0 group-hover:opacity-100 group-hover:animate-ping transition-opacity duration-500"></div>
            <div class="absolute -top-2 -right-2 w-3 h-3 bg-purple-400 rounded-full opacity-0 group-hover:opacity-100 group-hover:animate-ping transition-opacity duration-500 delay-150"></div>
        </div>
    {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize random view counts and read times
    

    // Text toggle functionality
    document.querySelectorAll('.toggle-text').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const container = this.closest('p');
            const shortText = container.querySelector('.short-text');
            const fullText = container.querySelector('.full-text');
            
            if (shortText.classList.contains('hidden')) {
                shortText.classList.remove('hidden');
                fullText.classList.add('hidden');
                this.innerHTML = '<i class="fas fa-chevron-down mr-1"></i>More';
            } else {
                shortText.classList.add('hidden');
                fullText.classList.remove('hidden');
                this.innerHTML = '<i class="fas fa-chevron-up mr-1"></i>Less';
            }
        });
    });

    // Copy button functionality with enhanced feedback and API call
    document.querySelectorAll('.copy-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
            const link = this.getAttribute('data-link');
            const postId = this.getAttribute('data-post-id');
            
            // Copy to clipboard
            navigator.clipboard.writeText(link).then(() => {
                const originalHTML = this.innerHTML;
                const originalClasses = this.className;
                
                // Update button appearance
                this.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
                this.className = originalClasses.replace('from-gray-500 to-gray-600', 'from-green-500 to-green-600')
                                            .replace('hover:from-gray-600 hover:to-gray-700', 'hover:from-green-600 hover:to-green-700');
                
                // Add celebration effect
                this.classList.add('animate-bounce');
                
                // Make POST request to update copy count
                fetch('http://127.0.0.1:8000/resources/click_on_copy/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    },
                    body: JSON.stringify({
                        post_id: postId
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        console.log('Copy count updated successfully:', data.copies);
                    } else {
                        console.error('Error updating copy count:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error updating copy count:', error);
                });
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    this.innerHTML = originalHTML;
                    this.className = originalClasses;
                    this.classList.remove('animate-bounce');
                }, 2000);
                
            }).catch(err => {
                console.error('Failed to copy: ', err);
                this.innerHTML = '<i class="fas fa-times mr-1"></i>Error';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-copy mr-1"></i>Copy';
                }, 2000);
            });
        });
    });

    // Enhanced like button functionality with API integration
    document.querySelectorAll('[data-like-button]').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const postId = this.getAttribute('data-post-id');
            const likesCount = this.querySelector('.likes-count');
            const icon = this.querySelector('i');
            let currentLikes = parseInt(likesCount.textContent);
            let isCurrentlyLiked = this.classList.contains('liked');
            let action = isCurrentlyLiked ? 'unlike' : 'like';
            
            // Optimistic UI update
            if (isCurrentlyLiked) {
                // Unlike - revert UI
                this.classList.remove('liked');
                this.classList.remove('from-red-100', 'to-pink-100', 'text-red-600', 'border-red-200');
                this.classList.add('from-red-50', 'to-pink-50', 'text-red-500', 'border-red-100');
                icon.classList.remove('fas');
                icon.classList.add('far');
                currentLikes = Math.max(0, currentLikes - 1);
            } else {
                // Like - update UI
                this.classList.add('liked');
                this.classList.remove('from-red-50', 'to-pink-50', 'text-red-500', 'border-red-100');
                this.classList.add('from-red-100', 'to-pink-100', 'text-red-600', 'border-red-200');
                icon.classList.remove('far');
                icon.classList.add('fas');
                currentLikes++;
                
                // Heart animation
                this.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 300);
            }
            
            likesCount.textContent = currentLikes;
            
            // AJAX call to update like in database
            fetch('http://127.0.0.1:8000/blogs/post-impression/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    post_id: postId,
                    action: action
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (!data.success) {
                    revertLikeUI(button, currentLikes, action);
                    console.error('Like action failed:', data.error);
                    showLikeError(button);
                } else {
                    likesCount.textContent = data.new_likes;
                    console.log(`Post ${postId} ${action}d successfully. New likes: ${data.new_likes}`);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                revertLikeUI(button, currentLikes, action);
                showLikeError(button);
            });
        });
    });

    

 

   



    // Helper function to revert UI changes on error
    function revertLikeUI(button, currentLikes, attemptedAction) {
        const likesCount = button.querySelector('.likes-count');
        const icon = button.querySelector('i');
        
        if (attemptedAction === 'like') {
            button.classList.remove('liked');
            button.classList.remove('from-red-100', 'to-pink-100', 'text-red-600', 'border-red-200');
            button.classList.add('from-red-50', 'to-pink-50', 'text-red-500', 'border-red-100');
            icon.classList.remove('fas');
            icon.classList.add('far');
            likesCount.textContent = Math.max(0, currentLikes - 1);
        } else {
            button.classList.add('liked');
            button.classList.remove('from-red-50', 'to-pink-50', 'text-red-500', 'border-red-100');
            button.classList.add('from-red-100', 'to-pink-100', 'text-red-600', 'border-red-200');
            icon.classList.remove('far');
            icon.classList.add('fas');
            likesCount.textContent = currentLikes + 1;
        }
    }

    // Helper function to show error feedback
    function showLikeError(button) {
        const originalHTML = button.innerHTML;
        const originalClasses = button.className;
        
        button.innerHTML = '<i class="fas fa-exclamation-triangle mr-1"></i>Error';
        button.className = originalClasses.replace('from-red-50 to-pink-50', 'from-yellow-500 to-orange-500')
                                        .replace('from-red-100 to-pink-100', 'from-yellow-500 to-orange-500')
                                        .replace('text-red-500', 'text-white')
                                        .replace('text-red-600', 'text-white')
                                        .replace('border-red-100', 'border-yellow-400')
                                        .replace('border-red-200', 'border-yellow-400');
        
        button.classList.add('animate-shake');
        
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.className = originalClasses;
            button.classList.remove('animate-shake');
        }, 2000);
    }

    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Add hover effects to entire cards
    document.querySelectorAll('.group').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>

<style>
    /* Custom scrollbar for library container */
    .library-container {
        max-height: 80px;
        overflow-y: auto;
    }
    
    .library-container::-webkit-scrollbar {
        width: 4px;
    }
    
    .library-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .library-container::-webkit-scrollbar-thumb {
        background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
        border-radius: 10px;
    }
    
    .library-container::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(to bottom, #2563eb, #7c3aed);
    }

    /* Smooth transitions */
    * {
        transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 300ms;
    }

    /* Enhanced like button states */
    [data-like-button].liked {
        background: linear-gradient(135deg, #fecaca, #fbcfe8) !important;
        border-color: #f87171 !important;
        color: #dc2626 !important;
    }

    /* Card hover effects */
    .group {
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .group:hover {
        transform: translateY(-8px) scale(1.02);
    }

    /* Gradient text animation */
    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .animate-gradient {
        background-size: 200% 200%;
        animation: gradientShift 3s ease infinite;
    }

    /* Shake animation for errors */
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }

    .animate-shake {
        animation: shake 0.5s ease-in-out;
    }

    /* Pulse animation for interactive elements */
    @keyframes gentlePulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .animate-gentle-pulse {
        animation: gentlePulse 2s ease-in-out infinite;
    }

    /* Premium shadow effects */
    .shadow-premium {
        box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1), 0 5px 20px -5px rgba(0, 0, 0, 0.04);
    }

    .hover\\:shadow-premium:hover {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 10px 30px -5px rgba(0, 0, 0, 0.1);
    }
</style>